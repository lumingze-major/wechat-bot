# 图像和视频识别功能使用说明

## 功能概述

微信机器人现已支持图像和视频识别功能，能够自动识别和分析用户发送的图片和视频内容。

## 主要特性

### 🖼️ 图像识别
- **自动处理**: 用户发送图片后，机器人会自动进行图像识别
- **详细分析**: 描述图片中的主要物体、场景、颜色、情感等信息
- **智能判断**: 自动启用深度思考模式，提供更准确的分析结果
- **支持格式**: JPG, PNG, GIF, WebP等常见图片格式

### 🎬 视频识别
- **视频分析**: 识别视频中的场景、动作、人物等内容
- **内容理解**: 分析视频的主要情节和情感表达
- **格式支持**: MP4, AVI, MOV等主流视频格式

### 💬 消息处理逻辑

#### 私聊场景
- ✅ 图片消息：自动识别并回复分析结果
- ✅ 视频消息：自动识别并回复分析结果
- ✅ 文本消息：正常对话功能

#### 群聊场景
- ✅ 图片消息：**无需@机器人**，自动识别所有图片
- ✅ 视频消息：**无需@机器人**，自动识别所有视频
- ⚠️ 文本消息：需要@机器人或包含关键词才会响应

## 配置说明

### 环境变量配置

在 `.env` 文件中添加以下配置：

```env
# 豆包视觉模型配置
DOUBAO_VISION_MODEL=doubao-vision-pro-32k
DOUBAO_VIDEO_MODEL=doubao-video-128k
```

### 模型说明

- **视觉模型**: `doubao-vision-pro-32k` - 用于图像识别和理解
- **视频模型**: `doubao-video-128k` - 用于视频内容分析

## 使用示例

### 图片识别示例

**用户操作**: 在微信中发送一张图片

**机器人回复**:
```
🖼️ 图片识别结果：

这是一张美丽的风景照片，画面中可以看到：
- 蔚蓝的天空中飘着几朵白云
- 远山连绵起伏，呈现出深浅不一的绿色
- 前景是一片开阔的草地，绿草如茵
- 整体色调清新自然，给人宁静祥和的感觉
- 光线柔和，可能是在黄昏时分拍摄
```

### 视频识别示例

**用户操作**: 在微信中发送一个视频

**机器人回复**:
```
🎬 视频识别结果：

这个视频展现了以下内容：
- 主要场景：城市街道的繁忙景象
- 人物活动：行人匆忙穿行，车辆川流不息
- 时间背景：看起来是上班高峰期
- 情感氛围：体现了现代都市生活的快节奏
- 拍摄角度：从高处俯拍，视野开阔
```

## 技术特性

### 🧠 智能判断
- 自动检测是否需要启用深度思考模式
- 针对图像和视频分析自动启用深度思考
- 提高分析结果的准确性和详细程度

### 📁 文件处理
- 自动保存接收到的图片和视频到临时目录
- 支持本地文件路径到base64的自动转换
- 定时清理临时文件，避免存储空间占用

### 🔄 错误处理
- 完善的错误捕获和处理机制
- 用户友好的错误提示信息
- 自动重试和降级处理

## 测试验证

运行以下命令进行功能测试：

```bash
# 完整系统测试
node test-complete-vision-system.js

# 基础功能测试
node test-vision-features.js
```

## 注意事项

1. **网络要求**: 需要稳定的网络连接访问豆包API
2. **文件大小**: 建议图片不超过10MB，视频不超过50MB
3. **处理时间**: 图片识别通常1-3秒，视频识别可能需要5-15秒
4. **隐私保护**: 临时文件会在处理完成后自动删除
5. **API配额**: 请注意豆包API的调用限制和费用

## 故障排除

### 常见问题

**Q: 图片识别失败怎么办？**
A: 检查图片格式是否支持，网络连接是否正常，API密钥是否正确配置。

**Q: 为什么群聊中的文本消息不响应？**
A: 这是正常行为，群聊中的文本消息需要@机器人才会响应，但图片和视频会自动处理。

**Q: 视频识别速度较慢？**
A: 视频文件较大时处理时间会更长，这是正常现象。可以尝试压缩视频或使用较短的视频片段。

## 更新日志

- **v1.0.0**: 初始版本，支持基础图片和视频识别
- **v1.1.0**: 添加智能判断功能，优化错误处理
- **v1.2.0**: 支持群聊中自动处理图片和视频消息

---

🎉 现在您的微信机器人已经具备了强大的视觉理解能力！